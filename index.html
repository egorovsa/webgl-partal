<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <link href="style.css" rel="stylesheet" type="text/css"/>

        <script id="shader-fs" type="x-shader/x-fragment">
              precision highp float;
              const float PI = 3.14159265359;
              uniform float uTime;
              uniform vec2 uResolution;

              float random (float p){
                  return fract(sin(p)*10000.);
              }

              float noice(vec2 p){
                  float t = uTime/2000.;

                  if(t>1.){
                      t-=floor(t);
                  }

                  return random(p.x * 14. + p.y * sin(t)*.05);
              }

              vec2 sw(vec2 p){
                  return vec2(floor(p.x),floor(p.y));
              }
              vec2 se(vec2 p){
                  return vec2(ceil(p.x),floor(p.y));
              }
              vec2 nw(vec2 p){
                  return vec2(floor(p.x),ceil(p.y));
              }
              vec2 ne(vec2 p){
                  return vec2(ceil(p.x),ceil(p.y));
              }

              float smoothNoice(vec2 p){
                  vec2 inter = smoothstep(0., 1.,  fract(p));

                  float s = mix(noice(sw(p)), noice(se(p)),inter.x);
                  float n = mix(noice(nw(p)), noice(ne(p)),inter.x);

                  return mix(s,n, inter.y);
              }

              mat2 rotate(in float theta){
                  float c = cos(theta);
                  float s = sin(theta);
                  return mat2(c,-s,s,c);
              }

              float fbm(in vec2 p){
                  float z = 2.;
                  float rz = 0.;
                  vec2 bp = p;
                  for( float i = 1.; i < 6.; i++){
                      rz += abs((smoothNoice(p) - 0.5)*2.) /z;
                      z = z * 2.;
                      p = p * 2.;
                  }

                  return rz;
              }

              float circ(vec2 p){
                  float r = length(p);

                  r = log(sqrt(r));

                  return  abs(mod(4.*r, PI *2.)- PI) * 3. +.2;
              }

              void main(void){
                  vec2 p = gl_FragCoord.xy / uResolution.xy - .5;

                  p.x*= uResolution.x / uResolution.y;

                  p *=4.;

                  float rz = fbm(p);

                  p/=exp(mod(uTime *.95,PI));

                  rz *= pow(abs(.4*circ(p)),.9);

                  vec3 col = vec3(0.2, 0.1, 0.643)/rz;
                  gl_FragColor = vec4(col, 1.0);
              }

        </script>
        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            void main(void) {
              gl_Position = vec4(aVertexPosition, 1.0);
            }
        </script>
        <script src="script.js" type="text/javascript"></script>

    </head>
    <body onload="bootstrap()">
        <canvas id="canvas"></canvas>
    </body>
</html>
